<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echocardiogram Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        /* Custom styling for the multiselect container */
        .multiselect-container {
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            padding: 0.5rem;
        }
        .multiselect-container label {
            display: flex;
            align-items: center;
            padding: 0.25rem;
            cursor: pointer;
        }
        .multiselect-container label:hover {
            background-color: #f9fafb;
        }
        /* Style for the report output console */
        #report-output-container {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 2rem;
            background-color: #f9fafb;
        }
        .report-section {
            background-color: #ffffff;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="p-4 sm:p-8 md:p-12 lg:p-16">
    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Input Form Console -->
        <div class="bg-white rounded-xl shadow-lg p-6 sm:p-8 md:p-10">
            <header class="text-center mb-8">
                <input type="text" id="hospitalName" placeholder="Beta Care Cardiology Service" class="text-center w-full text-2xl sm:text-3xl font-bold text-gray-800 bg-transparent border-none focus:outline-none">
                <h2 class="text-xl sm:text-2xl font-semibold text-gray-700 mt-2">2D, M-Mode and Doppler Echo Report</h2>
                <h3 class="text-lg sm:text-xl font-medium text-gray-600">Color Flow Doppler Report</h3>
            </header>

            <form id="echoReportForm">
                <!-- Patient and Sonographer Info -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="patientName" class="block text-sm font-medium text-gray-700">Patient Name</label>
                        <input type="text" id="patientName" name="patientName" placeholder="Bishop Luigi" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="sonographer" class="block text-sm font-medium text-gray-700">Sonographer</label>
                        <input type="text" id="sonographer" name="sonographer" placeholder="Kimani B" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700">Date</label>
                        <input type="date" id="date" name="date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="dob" class="block text-sm font-medium text-gray-700">Date of Birth (Year)</label>
                        <input type="number" id="dob" name="dob" placeholder="1991" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="gender" class="block text-sm font-medium text-gray-700">Gender</label>
                        <select id="gender" name="gender" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label for="referringPhysician" class="block text-sm font-medium text-gray-700">Referring Physician</label>
                        <input type="text" id="referringPhysician" name="referringPhysician" placeholder="DR OTIENO" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>

                <hr class="my-6 border-gray-300">

                <!-- LV Function -->
                <h4 class="text-lg font-bold text-gray-800 mb-4">LV FUNCTION & DIMENSIONS</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="lvSystolicFunction" class="block text-sm font-medium text-gray-700">LV Systolic Function</label>
                        <select id="lvSystolicFunction" name="lvSystolicFunction" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500 summary-input">
                            <option value="">Select Finding</option>
                            <option value="Normal LV systolic function">Normal</option>
                            <option value="Mildly impaired LV systolic function">Mildly Impaired</option>
                            <option value="Moderately impaired LV systolic function">Moderately Impaired</option>
                            <option value="Severely impaired LV systolic function">Severely Impaired</option>
                        </select>
                    </div>
                    <div>
                        <label for="lvef" class="block text-sm font-medium text-gray-700">LVEF (%)</label>
                        <input type="number" id="lvef" name="lvef" placeholder=">50" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 summary-input">
                    </div>
                    <div>
                        <label for="lvdiastolicFunction" class="block text-sm font-medium text-gray-700">LV Diastolic Function</label>
                        <select id="lvdiastolicFunction" name="lvdiastolicFunction" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500 summary-input">
                            <option value="">Select Finding</option>
                            <option value="Normal diastolic function">Normal</option>
                            <option value="Grade I diastolic dysfunction">Grade I</option>
                            <option value="Grade II diastolic dysfunction">Grade II</option>
                            <option value="Grade III diastolic dysfunction">Grade III</option>
                        </select>
                    </div>
                    <div>
                        <label for="lvad" class="block text-sm font-medium text-gray-700">LV Diastolic Diameter (cm)</label>
                        <input type="number" step="0.1" id="lvad" name="lvad" placeholder="3.7-5.6" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 summary-input">
                    </div>
                    <div>
                        <label for="ivs" class="block text-sm font-medium text-gray-700">IVS (cm)</label>
                        <input type="number" step="0.1" id="ivs" name="ivs" placeholder="0.6-1.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 summary-input">
                    </div>
                    <div>
                        <label for="lvepi" class="block text-sm font-medium text-gray-700">LVPW (cm)</label>
                        <input type="number" step="0.1" id="lvepi" name="lvepi" placeholder="0.6-1.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 summary-input">
                    </div>
                </div>
                
                <hr class="my-6 border-gray-300">

                <!-- Right Heart -->
                <h4 class="text-lg font-bold text-gray-800 mb-4">RIGHT HEART</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="rvFunction" class="block text-sm font-medium text-gray-700">RV Function</label>
                        <select id="rvFunction" name="rvFunction" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500 summary-input">
                            <option value="">Select Finding</option>
                            <option value="Normal RV systolic function">Normal</option>
                            <option value="Mildly impaired RV systolic function">Mildly Impaired</option>
                            <option value="Moderately impaired RV systolic function">Moderately Impaired</option>
                            <option value="Severely impaired RV systolic function">Severely Impaired</option>
                        </select>
                    </div>
                    <div>
                        <label for="rvd" class="block text-sm font-medium text-gray-700">RV Diameter (cm)</label>
                        <input type="number" step="0.1" id="rvd" name="rvd" placeholder="0.7-2.3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 summary-input">
                    </div>
                    <div>
                        <label for="raSize" class="block text-sm font-medium text-gray-700">Right Atrial Size</label>
                        <select id="raSize" name="raSize" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500 summary-input">
                            <option value="">Select Finding</option>
                            <option value="Normal right atrial size">Normal</option>
                            <option value="Dilated right atrium">Dilated</option>
                        </select>
                    </div>
                </div>

                <hr class="my-6 border-gray-300">

                <!-- Aorta and Pulmonary Artery -->
                <h4 class="text-lg font-bold text-gray-800 mb-4">AORTA & PULMONARY ARTERY</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="aorticRoot" class="block text-sm font-medium text-gray-700">Aortic Root (cm)</label>
                        <input type="number" step="0.1" id="aorticRoot" name="aorticRoot" placeholder="2.0-3.7" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 summary-input">
                    </div>
                    <div>
                        <label for="aorta" class="block text-sm font-medium text-gray-700">Ascending Aorta (cm)</label>
                        <input type="number" step="0.1" id="aorta" name="aorta" placeholder="<3.8" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 summary-input">
                    </div>
                    <div>
                        <label for="pulmonaryArtery" class="block text-sm font-medium text-gray-700">Pulmonary Artery (cm)</label>
                        <input type="number" step="0.1" id="pulmonaryArtery" name="pulmonaryArtery" placeholder="<2.9" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 summary-input">
                    </div>
                </div>

                <hr class="my-6 border-gray-300">

                <!-- Valvular Findings (Multi-select) -->
                <h4 class="text-lg font-bold text-gray-800 mb-4">VALVULAR FINDINGS</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <!-- Aortic Valve -->
                    <div class="summary-multiselect">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Aortic Valve</label>
                        <div class="multiselect-container">
                            <label>
                                <input type="checkbox" name="aorticValve" value="Normal Aortic valve morphology and function">
                                <span class="ml-2 text-sm text-gray-700">Normal</span>
                            </label>
                            <label>
                                <input type="checkbox" name="aorticValve" value="Bicuspid Aortic valve">
                                <span class="ml-2 text-sm text-gray-700">Bicuspid</span>
                            </label>
                            <label>
                                <input type="checkbox" name="aorticValve" value="Calcific aortic valve disease">
                                <span class="ml-2 text-sm text-gray-700">Calcific disease</span>
                            </label>
                            <label>
                                <input type="checkbox" name="aorticValve" value="Aortic valve is stenotic">
                                <span class="ml-2 text-sm text-gray-700">Stenotic</span>
                            </label>
                            <label>
                                <input type="checkbox" name="aorticValve" value="Aortic valve is prolapsing">
                                <span class="ml-2 text-sm text-gray-700">Prolapsing</span>
                            </label>
                        </div>
                    </div>

                    <!-- Aortic Regurgitation -->
                    <div class="summary-multiselect">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Aortic Regurgitation</label>
                        <div class="multiselect-container">
                            <label>
                                <input type="checkbox" name="aorticRegurgitation" value="No aortic regurgitation">
                                <span class="ml-2 text-sm text-gray-700">None</span>
                            </label>
                            <label>
                                <input type="checkbox" name="aorticRegurgitation" value="Trivial aortic regurgitation">
                                <span class="ml-2 text-sm text-gray-700">Trivial</span>
                            </label>
                            <label>
                                <input type="checkbox" name="aorticRegurgitation" value="Mild aortic regurgitation">
                                <span class="ml-2 text-sm text-gray-700">Mild</span>
                            </label>
                            <label>
                                <input type="checkbox" name="aorticRegurgitation" value="Moderate aortic regurgitation">
                                <span class="ml-2 text-sm text-gray-700">Moderate</span>
                            </label>
                            <label>
                                <input type="checkbox" name="aorticRegurgitation" value="Severe aortic regurgitation">
                                <span class="ml-2 text-sm text-gray-700">Severe</span>
                            </label>
                        </div>
                    </div>

                    <!-- Mitral Valve -->
                    <div class="summary-multiselect">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Mitral Valve</label>
                        <div class="multiselect-container">
                            <label>
                                <input type="checkbox" name="mitralValve" value="Normal Mitral valve morphology and function">
                                <span class="ml-2 text-sm text-gray-700">Normal</span>
                            </label>
                            <label>
                                <input type="checkbox" name="mitralValve" value="Rheumatic mitral valve disease with restricted leaflet motion">
                                <span class="ml-2 text-sm text-gray-700">Rheumatic disease</span>
                            </label>
                            <label>
                                <input type="checkbox" name="mitralValve" value="Mitral valve prolapse">
                                <span class="ml-2 text-sm text-gray-700">Mitral prolapse</span>
                            </label>
                            <label>
                                <input type="checkbox" name="mitralValve" value="Mitral annular calcification">
                                <span class="ml-2 text-sm text-gray-700">Annular calcification</span>
                            </label>
                            <label>
                                <input type="checkbox" name="mitralValve" value="Mitral valve is stenotic">
                                <span class="ml-2 text-sm text-gray-700">Stenotic</span>
                            </label>
                        </div>
                    </div>

                    <!-- Mitral Regurgitation -->
                    <div class="summary-multiselect">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Mitral Regurgitation</label>
                        <div class="multiselect-container">
                            <label>
                                <input type="checkbox" name="mitralRegurgitation" value="No mitral regurgitation">
                                <span class="ml-2 text-sm text-gray-700">None</span>
                            </label>
                            <label>
                                <input type="checkbox" name="mitralRegurgitation" value="Trivial mitral regurgitation">
                                <span class="ml-2 text-sm text-gray-700">Trivial</span>
                            </label>
                            <label>
                                <input type="checkbox" name="mitralRegurgitation" value="Mild mitral regurgitation">
                                <span class="ml-2 text-sm text-gray-700">Mild</span>
                            </label>
                            <label>
                                <input type="checkbox" name="mitralRegurgitation" value="Moderate mitral regurgitation">
                                <span class="ml-2 text-sm text-gray-700">Moderate</span>
                            </label>
                            <label>
                                <input type="checkbox" name="mitralRegurgitation" value="Severe mitral regurgitation">
                                <span class="ml-2 text-sm text-gray-700">Severe</span>
                            </label>
                        </div>
                    </div>

                    <!-- Tricuspid & Pulmonic Valves -->
                    <div class="summary-multiselect">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tricuspid Regurgitation</label>
                        <div class="multiselect-container">
                            <label>
                                <input type="checkbox" name="tricuspidRegurgitation" value="No tricuspid regurgitation">
                                <span class="ml-2 text-sm text-gray-700">None</span>
                            </label>
                            <label>
                                <input type="checkbox" name="tricuspidRegurgitation" value="Trivial tricuspid regurgitation">
                                <span class="ml-2 text-sm text-gray-700">Trivial</span>
                            </label>
                            <label>
                                <input type="checkbox" name="tricuspidRegurgitation" value="Mild tricuspid regurgitation">
                                <span class="ml-2 text-sm text-gray-700">Mild</span>
                            </label>
                            <label>
                                <input type="checkbox" name="tricuspidRegurgitation" value="Moderate tricuspid regurgitation">
                                <span class="ml-2 text-sm text-gray-700">Moderate</span>
                            </label>
                            <label>
                                <input type="checkbox" name="tricuspidRegurgitation" value="Severe tricuspid regurgitation">
                                <span class="ml-2 text-sm text-gray-700">Severe</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <hr class="my-6 border-gray-300">

                <!-- Other Findings -->
                <h4 class="text-lg font-bold text-gray-800 mb-4">OTHER FINDINGS</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="summary-multiselect">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Pericardial Effusion</label>
                        <div class="multiselect-container">
                            <label>
                                <input type="checkbox" name="pericardialEffusion" value="No pericardial effusion noted">
                                <span class="ml-2 text-sm text-gray-700">No effusion</span>
                            </label>
                            <label>
                                <input type="checkbox" name="pericardialEffusion" value="Small pericardial effusion noted">
                                <span class="ml-2 text-sm text-gray-700">Small effusion</span>
                            </label>
                            <label>
                                <input type="checkbox" name="pericardialEffusion" value="Moderate pericardial effusion noted">
                                <span class="ml-2 text-sm text-gray-700">Moderate effusion</span>
                            </label>
                            <label>
                                <input type="checkbox" name="pericardialEffusion" value="Large pericardial effusion with signs of tamponade">
                                <span class="ml-2 text-sm text-gray-700">Large effusion with tamponade</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label for="ivc" class="block text-sm font-medium text-gray-700">IVC</label>
                        <select id="ivc" name="ivc" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500 summary-input">
                            <option value="">Select Finding</option>
                            <option value="Normal IVC diameter and collapsibility">Normal</option>
                            <option value="Dilated IVC with reduced collapsibility">Dilated</option>
                        </select>
                    </div>
                </div>

                <div class="flex justify-end mt-8">
                    <button type="button" id="generateReportButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-colors duration-300">Generate Report</button>
                </div>
            </form>
        </div>

        <!-- Report Output Console -->
        <div id="report-output-container" class="lg:sticky lg:top-8 self-start">
            <header class="text-center mb-6">
                <h2 class="text-xl sm:text-2xl font-semibold text-gray-800">Generated Report</h2>
            </header>
            
            <div id="report-content" class="space-y-4">
                <div class="report-section">
                    <h5 class="text-md font-semibold text-gray-700 mb-2">Findings:</h5>
                    <div id="findings-output" class="text-sm text-gray-800 leading-relaxed min-h-[50px]">
                        <!-- Findings will be dynamically inserted here -->
                    </div>
                </div>
                
                <div class="report-section">
                    <h5 class="text-md font-semibold text-gray-700 mb-2">Summary and Conclusion:</h5>
                    <textarea id="summary-conclusion" rows="5" class="w-full text-sm text-gray-800 bg-gray-50 rounded-md border-gray-300 shadow-sm p-2 resize-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                </div>

                <div class="report-section">
                    <h5 class="text-md font-semibold text-gray-700 mb-2">Recommendation:</h5>
                    <textarea id="recommendation" rows="5" class="w-full text-sm text-gray-800 bg-gray-50 rounded-md border-gray-300 shadow-sm p-2 resize-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                </div>
            </div>

            <div class="flex justify-end mt-6">
                <button type="button" id="exportPdfButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-colors duration-300">Export as PDF</button>
            </div>
        </div>

        <!-- A simple message box to replace alert() -->
        <div id="messageBox" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg p-6 shadow-xl max-w-sm w-full text-center">
                <p id="messageText" class="text-gray-800 font-medium mb-4"></p>
                <button id="closeMessage" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md">OK</button>
            </div>
        </div>
    </div>

    <script>
        // A simple function to show a modal-style message box
        function showMessageBox(message) {
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
        }

        // Close the message box
        document.getElementById('closeMessage').addEventListener('click', () => {
            document.getElementById('messageBox').classList.add('hidden');
        });

        // Function to update the findings section
        function updateFindings() {
            const findingsOutput = document.getElementById('findings-output');
            let findingsArray = [];

            // Helper function to get the value from an element and add to findings array if it exists
            const addValueToFindings = (id, prefix = '') => {
                const element = document.getElementById(id);
                if (element) {
                    let value = '';
                    if (element.tagName === 'SELECT') {
                        value = element.options[element.selectedIndex].value;
                    } else {
                        value = element.value;
                    }

                    if (value) {
                        findingsArray.push(prefix + value.trim());
                    }
                }
            };
            
            // Helper function to get values from a multiselect and add to findings array
            const addMultiselectToFindings = (containerClass) => {
                const containers = document.querySelectorAll(`.${containerClass} input[type="checkbox"]:checked`);
                containers.forEach(checkbox => {
                    findingsArray.push(checkbox.value);
                });
            };

            // Patient Information
            const patientName = document.getElementById('patientName').value;
            const dob = document.getElementById('dob').value;
            const gender = document.getElementById('gender').value;
            if (patientName) {
                 const currentYear = new Date().getFullYear();
                 const age = dob ? (currentYear - dob) : 'unknown';
                 findingsArray.push(`Echocardiogram report for ${patientName}, Age: ${age}, Gender: ${gender}`);
            }

            // LV Function & Dimensions
            addValueToFindings('lvSystolicFunction');
            if (document.getElementById('lvef').value) {
                findingsArray.push(`LVEF is ${document.getElementById('lvef').value}%.`);
            }
            addValueToFindings('lvdiastolicFunction');
            if (document.getElementById('lvad').value) {
                findingsArray.push(`LV Diastolic Diameter: ${document.getElementById('lvad').value} cm.`);
            }
            if (document.getElementById('ivs').value) {
                findingsArray.push(`IVS: ${document.getElementById('ivs').value} cm.`);
            }
            if (document.getElementById('lvepi').value) {
                findingsArray.push(`LVPW: ${document.getElementById('lvepi').value} cm.`);
            }
            
            // Right Heart
            addValueToFindings('rvFunction');
            if (document.getElementById('rvd').value) {
                findingsArray.push(`RV Diameter: ${document.getElementById('rvd').value} cm.`);
            }
            addValueToFindings('raSize');

            // Aorta & Pulmonary Artery
            if (document.getElementById('aorticRoot').value) {
                findingsArray.push(`Aortic Root: ${document.getElementById('aorticRoot').value} cm.`);
            }
            if (document.getElementById('aorta').value) {
                findingsArray.push(`Ascending Aorta: ${document.getElementById('aorta').value} cm.`);
            }
            if (document.getElementById('pulmonaryArtery').value) {
                findingsArray.push(`Pulmonary Artery: ${document.getElementById('pulmonaryArtery').value} cm.`);
            }

            // Valvular Findings (Multi-select)
            addMultiselectToFindings('summary-multiselect');

            // Other Findings
            addValueToFindings('ivc');
            
            // Set the final findings text
            findingsOutput.innerHTML = findingsArray.length > 0 ? findingsArray.join('<br>') : 'Findings will be dynamically inserted here...';
        }

        // Add event listeners to all relevant inputs to update the findings
        document.querySelectorAll('.summary-input').forEach(input => {
            input.addEventListener('change', updateFindings);
            input.addEventListener('input', updateFindings);
        });

        // Add event listeners for the new multiselect checkboxes
        document.querySelectorAll('.summary-multiselect input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateFindings);
        });

        // Handle the generate button click
        document.getElementById('generateReportButton').addEventListener('click', function() {
            updateFindings();
            showMessageBox('Report findings have been compiled in the right panel. Now you can add the conclusion and recommendation.');
        });

        // Handle the export to PDF button click
        document.getElementById('exportPdfButton').addEventListener('click', function() {
            const reportContent = document.getElementById('report-content');
            const hospitalName = document.getElementById('hospitalName').value || 'Echocardiogram Report';
            const patientName = document.getElementById('patientName').value || 'N/A';
            const sonographer = document.getElementById('sonographer').value || 'N/A';
            const date = document.getElementById('date').value || 'N/A';
            const dob = document.getElementById('dob').value || 'N/A';
            const gender = document.getElementById('gender').value || 'N/A';
            const referringPhysician = document.getElementById('referringPhysician').value || 'N/A';
            
            // Build the HTML content for the PDF, including the header and patient details
            const headerHtml = `
                <div style="text-align: center; font-family: 'Inter', sans-serif; color: #1f2937; margin-bottom: 20px;">
                    <h1 style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">${hospitalName}</h1>
                    <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 20px;">2D, M-Mode and Doppler Echo Report</h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: left;">
                        <p><strong>Patient Name:</strong> ${patientName}</p>
                        <p><strong>Sonographer:</strong> ${sonographer}</p>
                        <p><strong>Date:</strong> ${date}</p>
                        <p><strong>Date of Birth (Year):</strong> ${dob}</p>
                        <p><strong>Gender:</strong> ${gender}</p>
                        <p><strong>Referring Physician:</strong> ${referringPhysician}</p>
                    </div>
                </div>
            `;

            // Create a temporary element to hold the full formatted report for PDF generation
            const tempElement = document.createElement('div');
            tempElement.innerHTML = headerHtml + reportContent.outerHTML;
            tempElement.style.padding = '20mm'; // Add some padding for better PDF layout
            tempElement.style.backgroundColor = '#ffffff';

            document.body.appendChild(tempElement);
            
            const fileName = patientName !== 'N/A' ? `${hospitalName} - ${patientName}.pdf` : `${hospitalName}.pdf`;

            setTimeout(() => {
                html2pdf()
                    .from(tempElement)
                    .set({
                        margin: 10,
                        filename: fileName,
                        html2canvas: { scale: 2 },
                        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                    })
                    .save()
                    .finally(() => {
                        document.body.removeChild(tempElement);
                    });
            }, 0);
        });
    </script>
</body>
</html>
